applicationApiVersion: v1beta1

properties:
  name:
    type: string
    x-google-marketplace:
      type: NAME
  namespace:
    type: string
    x-google-marketplace:
      type: NAMESPACE

  # general
  serviceAccount:
    type: string
    title: Presslabs Dashboard Service Account
    description: Service account that will be assigned to the Presslabs Dashboard.
    x-google-marketplace:
      type: SERVICE_ACCOUNT
      serviceAccount:
        roles:
        - type: ClusterRole
          rulesType: PREDEFINED
          rulesFromRoleName: cluster-admin

  appUID:
    type: string
    title: Application UID
    description: The UUID of the Presslabs Dashboard application. Not required, so if not entered an UUID will be generated anyway.
    x-google-marketplace:
      type: APPLICATION_UID

  # dashboard
  dashboardDomain:
    type: string
    title: Presslabs Dashboard Domain
    description: This will be the domain used by the Presslabs Dashboard.
    default: example.com
  dashboardIP:
    type: string
    default: ""
    title: IP Address
    description: |
      We recommend that you get a pre-allocated static IP address for your Presslabs Dashboard to prevent IP changes.
      You can get one from the Ingress section in the Google Kubernetes dashboard. Read more about it
      <a href="https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address">here</a>.
  dashboardImage:
    type: string
    default: $REGISTRY:$TAG
    x-google-marketplace:
      type: IMAGE
  dashboardProjectID:
    type: string
    title: Project ID
    description: Where to deploy the Presslabs Dashboard application. This will be used to provision other services such as storage.
    default: ""
  dashboardServiceAccountKey:
    type: string
    title: Service Account Key
    description: A service account key in JSON format. This service account is used for provisioning other Google services.
    x-google-marketplace:
      type: STRING
      string:
        generatedProperties:
          base64Encoded: explicitPasswordEncoded
  dashboardOIDCClientID:
    type: string
    title: Auth0 Connect ID
    description: This is the Auth0 client ID
    x-google-marketplace:
      type: STRING
      string:
        generatedProperties:
          base64Encoded: explicitPasswordEncoded
  dashboardOIDCSecret:
    type: string
    title: Auth0 Connect Secret
    description: The client secret needed to connect to Auth0
    x-google-marketplace:
      type: STRING
      string:
        generatedProperties:
          base64Encoded: explicitPasswordEncoded
  dashboardOIDCIssuer:
    type: string
    title: Auth0 issuer URL
    description: The URL where Auth0 can find the OpenID Provider Configuration Document.
    default: "https://example.auth0.com/"
    x-google-marketplace:
      type: STRING
      string:
        generatedProperties:
          base64Encoded: explicitPasswordEncoded

  # cert-manager
  certManagerImage:
    type: string
    default: $REGISTRY/cert-manager-controller:$TAG
    x-google-marketplace:
      type: IMAGE
      image:
        generatedProperties:
          splitByColon:
            before: certManagerImageRegistry
            after: certManagerImageTag
  certAcmeSolverImage:
    type: string
    default: $REGISTRY/cert-manager-acmesolver:$TAG
    x-google-marketplace:
      type: IMAGE
  certWebhookImage:
    type: string
    default: $REGISTRY/cert-manager-webhook:$TAG
    x-google-marketplace:
      type: IMAGE
      image:
        generatedProperties:
          splitByColon:
            before: certWebhookImageRegistry
            after: certWebhookImageTag
  certCAinjectorImage:
    type: string
    default: $REGISTRY/cert-manager-cainjector:$TAG
    x-google-marketplace:
      type: IMAGE
      image:
        generatedProperties:
          splitByColon:
            before: certCAinjectorImageRegistry
            after: certCAinjectorImageTag

  # ingress controller
  ingressImage:
    type: string
    default: $REGISTRY/ingress-controller:$TAG
    x-google-marketplace:
      type: IMAGE
      image:
        generatedProperties:
          splitByColon:
            before: ingressImageRegistry
            after: ingressImageTag
  ingressDefaultBackendImage:
    type: string
    default: $REGISTRY/ingress-default-backend:$TAG
    x-google-marketplace:
      type: IMAGE
      image:
        generatedProperties:
          splitByColon:
            before: ingressDefaultBackendImageRegistry
            after: ingressDefaultBackendImageTag

  # mysql-operator
  mysqlControllerImage:
    type: string
    default: $REGISTRY/mysql-operator:$TAG
    x-google-marketplace:
      type: IMAGE
  mysqlOrchestratorImage:
    type: string
    default: $REGISTRY/mysql-orchestrator:$TAG
    x-google-marketplace:
      type: IMAGE

  mysqlOrchestratorPassword:
    type: string
    x-google-marketplace:
      type: GENERATED_PASSWORD
      generatedPassword:
        length: 16
        includeSymbols: False
        base64: True

  # wordpress operator
  wordpressOperatorImage:
    type: string
    default: $REGISTRY/wordpress-operator:$TAG
    x-google-marketplace:
      type: IMAGE

  # let's encrypt
  letsEncryptEmail:
    type: string
    title: Let's Encrypt Email
    description: Let's Encrypt will use this to contact you about expiring certificates, and issues related to your account.
    default: 'ping@example.com'

  letsEncryptServer:
    type: string
    title: Let's Encrypt Server
    description: The Let's Encrypt API endpoint
    default: 'https://acme-v02.api.letsencrypt.org/directory'
    enum:
      - 'https://acme-v02.api.letsencrypt.org/directory'
      - 'https://acme-staging-v02.api.letsencrypt.org/directory'

  # miscellaneous
  kubectlImage:
    type: string
    default: $REGISTRY/kubectl:$TAG
    x-google-marketplace:
      type: IMAGE

  reportingSecret:
    type: string
    x-google-marketplace:
      type: REPORTING_SECRET

  prometheusOperatorEnabled:
    type: boolean
    default: false
    title: Is Prometheus Operator Enabled in Cluster
    description: To enable extra features of the Presslabs Dashboard it requires to have installed Prometheus Operator in cluster.

  gcpConfigConnectorEnabled:
    type: boolean
    default: false
    title: Is GCP Config Connector Enabled in Cluster
    description: To run the Presslabs Dashboard it reuqres to have GCP Config Connect enabled into k8s cluster.


required:
- name
- namespace
- dashboardDomain
- dashboardServiceAccountKey
- dashboardOIDCClientID
- dashboardOIDCSecret
- dashboardOIDCIssuer
- dashboardProjectID
- prometheusOperatorEnabled
- gcpConfigConnectorEnabled
