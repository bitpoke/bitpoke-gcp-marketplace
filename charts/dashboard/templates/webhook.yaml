# Code generated by Makefile. DO NOT EDIT.
{{ $domain := printf "%s-webhook.%s.svc" (include "dashboard.name" .) .Release.Namespace }}
{{ $cert := genSelfSignedCert $domain nil nil 3650 }}

apiVersion: v1
data:
  ca-cert.pem: '{{ $cert.Cert | b64enc }}'
  cert.pem: '{{ $cert.Cert | b64enc }}'
  key.pem: '{{ $cert.Key | b64enc }}'
kind: Secret
metadata:
  labels:
    app: '{{ include "dashboard.name" . }}'
    chart: '{{ include "dashboard.chart" . }}'
    heritage: '{{ .Release.Service }}'
    release: '{{ .Release.Name }}'
  name: '{{ include "dashboard.webhook.secretName" . }}'
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: '{{ include "dashboard.name" . }}'
    chart: '{{ include "dashboard.chart" . }}'
    heritage: '{{ .Release.Service }}'
    release: '{{ .Release.Name }}'
  name: '{{ include "dashboard.webhook.serviceName" . }}'
spec:
  ports:
  - port: {{ .Values.webhook.service.port }}
    targetPort: {{ .Values.webhook.service.targetPort }}
    protocol: TCP
    name: http
  selector:
    app: '{{ include "dashboard.name" . }}'
    release: '{{ .Release.Name }}'
    component: controller
  type: '{{ .Values.webhook.service.type }}'
status:
  loadBalancer: {}
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  labels:
    app: '{{ include "dashboard.name" . }}'
    chart: '{{ include "dashboard.chart" . }}'
    heritage: '{{ .Release.Service }}'
    release: '{{ .Release.Name }}'
  name: '{{ include "dashboard.fullname" . }}'
webhooks:
- clientConfig:
    caBundle: '{{ $cert.Cert | b64enc }}'
    service:
      name: '{{ include "dashboard.webhook.serviceName" . }}'
      namespace: '{{ .Release.Namespace }}'
      path: /validating-create-organization
  failurePolicy: Fail
  name: validating-create-organization.presslabs.com
  namespaceSelector:
    matchExpressions:
    - key: control-plane
      operator: DoesNotExist
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - namespaces
- clientConfig:
    caBundle: '{{ $cert.Cert | b64enc }}'
    service:
      name: '{{ include "dashboard.webhook.serviceName" . }}'
      namespace: '{{ .Release.Namespace }}'
      path: /validating-create-project
  failurePolicy: Fail
  name: validating-create-project.presslabs.com
  namespaceSelector:
    matchExpressions:
    - key: control-plane
      operator: DoesNotExist
  rules:
  - apiGroups:
    - ""
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - namespaces
- clientConfig:
    caBundle: '{{ $cert.Cert | b64enc }}'
    service:
      name: '{{ include "dashboard.webhook.serviceName" . }}'
      namespace: '{{ .Release.Namespace }}'
      path: /validating-create-site
  failurePolicy: Fail
  name: validating-create-site.presslabs.com
  namespaceSelector:
    matchExpressions:
    - key: control-plane
      operator: DoesNotExist
  rules:
  - apiGroups:
    - wordpress.presslabs.org
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - wordpresses
